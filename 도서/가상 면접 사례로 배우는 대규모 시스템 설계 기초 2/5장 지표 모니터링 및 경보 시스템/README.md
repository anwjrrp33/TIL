# 5장 지표 모니터링 및 경보 시스템
규모 확정이 용이한 지표 모니터링 및 경보 시스템의 설계안

## 1. 문제 이해 및 설계 범위 확정
* 인프라 지표에 관심이 있다면 웹 서버 에러 로그나 엑세스 로그에 초점을 맞춘 시스템을 만들면 곤란한다.
```
Q1. 시스템의 고객은 누구인가요?
→ 회사 내부에서 사용할 시스템이라고 합시다.

Q2. 어떤 지표를 수집해야 하나요?
→ 시스템 운영 지표를 수집해야 하고 CPU 부하, 메모리 사용률, 디스크 사용률 같은 저수준 운영체제 사용 지표일 수도 있고, 서버가 처리하는 초당 요청 수나 웹 서버 프로세스 개수 같은 고차원적 개념에 관련된 지표일 수 있지만 사업 지표는 이 시스템이 처리할 지표가 아닙니다.

Q3. 모니터링할 인프라 규모는 어느 정도입니까?
→ 일간 능동 사용자 수는 1억 명, 1000개의 서버 풀이 있고 풀마다 100개의 서버 하드웨어를 유지합니다.

Q4. 지표 데이터는 얼마나 오래 유지해야 하나요?
→ 1년 동안은 보관해야 한다고 합시다.

Q5. 데이터를 장기 보관 전용 저장소로 옮길 때 지표의 해상도를 낮추어도 괜찮을까요?
→ 새로 수집한 데이터는 7일 동안 보관하는 것으로 하고, 7일 뒤에는 1분 단위 데이터로 만들어 30일 동안 보관하고, 그 뒤에는 1시간 단위 데이터로 변환해서 보관하는 것으로 합시다.

Q6. 경보 채널로는 어떤 것들을 지원해야 할까요?
→ 이메일, 전화, 페이저듀티, 웹훅 등을 지원하는 것으로 합시다.

Q7. 에러 로그나 엑세스 로그 등에 대한 수집 기능도 제공해야 하나요?
→ 아니요.

Q8. 분산 시스템 추적 기능도 제공해야 하나요?
→ 필요 없습니다.
```

### 개략적 요구사항 및 가정
* 대규모 인프라를 모니터링 해야한다.
  * 일간 능동 사용자 수 1억 명
  * 서버 풀 1,000개, 풀당 서버 수 100개이고 서버당 100개의 운영 지표를 수집한다고 치면 모니터링해야 하는 지표의 수는 천만 개 수준
  * 데이터 보관 기간은 1년
  * 수집한 그대로 데이터를 보관하는 기간은 7일, 그 뒤에는 1분 단위 데이터로 변환한 후에 30일간 보관, 그 뒤에는 1시간 단위 데이터로 변환한 뒤에 1년간 보관
* 모니터링할 지표는 다양한데 아래와 같은 것이 존재한다.
  * CPU 사용률
  * 요청 수
  * 메모리 사용량
  * 메시지 큐 내의 메시지 수

### 비기능 요구사항
* 규모 확장성: 시스템은 늘어나는 지표 수와 경보의 양에 맞게 확장될 수 있어야 한다.
* 낮은 응답 지연: 대시보드와 경보를 신속하게 처리할 수 있도록, 질의에 대한 낮은 응답 지연을 보장해야 한다.
* 안정성: 높은 안전성을 제공하여 중요 경보를 놓치지 않도록 해야 한다.
* 유연성: 기술은 계속 변화하므로, 미래의 신기술을 쉽게 통합할 수 있도록 유연하게 변경 가능한 파이프라인을 이용해 구축한 시스템이어야 한다.

## 2. 개략적 설계안 제시 및 동의 구하기

### 기본적 사항
