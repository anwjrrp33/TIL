# 10. 클라우드에서 사용하는 레디스

## 10.1 OSS와 레디스의 차이
OSS 버전의 레디스를 운영할 경우 사용자가 직접 장애 대응이나 메트릭 모니터링 등을 관리해야 하지만 ElastiCache는 관리형 서비스이기 때문에 수고를 덜 수 있다.

<table>
    <thead>
        <tr>
            <th>기능</th>
            <th>세부 사항</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>완전 관리</td>
            <td>
                <ul>
                    <li>하드웨어 프로비저닝</li>
                    <li>소프트웨어 패치 적용</li>
                    <li>셋업</li>
                    <li>설정 작업</li>
                    <li>모니터링</li>
                    <li>장애 시 자동 복구</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>쉬운 스케일</td>
            <td>스케일링이 용이함</td>
        </tr>
        <tr>
            <td>백업 및 복원</td>
            <td>자동 및 수동 백업/복원 기능</td>
        </tr>
        <tr>
            <td>이벤트 알림 기능</td>
            <td>이벤트 발생 시 알림 기능 제공</td>
        </tr>
        <tr>
            <td>셀프서비스 업데이트 기능</td>
            <td>사용자가 직접 업데이트 가능</td>
        </tr>
        <tr>
            <td>자동 페일오버</td>
            <td>자동으로 페일오버 수행</td>
        </tr>
        <tr>
            <td>지능형 스왑 메모리 관리</td>
            <td>메모리 관리를 위한 지능형 스왑 기능</td>
        </tr>
        <tr>
            <td>고유한 매개변수</td>
            <td>
                <ul>
                    <li>reserved-memory-percent (2017년 3월 16일 이전 사용자는 reserved-memory)</li>
                    <li>close-on-replica-write (Redis 5.0 미만 버전에서는 close-on-slave-write)</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>온라인 리샤딩</td>
            <td>실시간으로 리샤딩 가능</td>
        </tr>
        <tr>
            <td>자동 쓰기 슬롯 스로틀링</td>
            <td>자동으로 쓰기 슬롯을 스로틀링</td>
        </tr>
        <tr>
            <td>안전성 및 규정 준수</td>
            <td>안전성과 규정 준수를 충족함</td>
        </tr>
        <tr>
            <td>일부 캐시 노드 유형에서 ElastiCache 최적화</td>
            <td>MS/RS 이상의 캐시 노드에서 최적화 기능 제공</td>
        </tr>
        <tr>
            <td>일부 캐시 노드 유형에서 I/O 처리 다중 스레딩</td>
            <td>M5/R5 이상의 캐시 노드에서 I/O 처리에 다중 스레딩 지원</td>
        </tr>
        <tr>
            <td>지역 간 레플리케이션 기능</td>
            <td>다른 지역 간 레플리케이션 가능</td>
        </tr>
        <tr>
            <td>계획된 유지보수 온라인 실행</td>
            <td>유지보수를 온라인에서 실행 가능</td>
        </tr>
        <tr>
            <td>데이터 계층화</td>
            <td>데이터 계층화를 지원</td>
        </tr>
        <tr>
            <td>자동 스케일링</td>
            <td>자동으로 스케일링 수행</td>
        </tr>
    </tbody>
</table>

### 10.1.1 고유 기능
#### 이벤트 알림 기능
클러스터에서 중요 이벤트 발생 시 알림을 받게 되고 알림을 통해 관리 콘솔뿐 아니라 AWS CLI, AWS SDK에서 이벤트를 처리할 수 있으며 SNS와 연동해 이벤트 발생 시 이메일, SMS, 람다, SQS가 실행되도록 할 수 있다.

> 이벤트 알림 기능은 노드 장애 감지나 일부 유지보수 정보를 확인하기 위해 설정해 두는 것이 좋다.

#### 셀프서비스 업데이트 기능
업데이트의 적용 시기와 내용을 더욱 유연하게 제어할 수 있고 일반적으로 유지보수에는 다운타임이 필요한데 현업에서는 특정 일시에 시스템이 유지보수하도록 유지보수 창 내에서 실행 시간을 설정해 제어하게 된다.

유지보수 창보다 유연하게 유지보수 실행 시간을 제어할 수 있는 시스템이 셀프서비스 업데이트 기능이고 셀프서비스 업데이트 기능은 적용 시기와 적용할 업데이트 내용도 설정할 수 있으며 또한 우선순위가 높은 업데이트는 빠르게 적용하고 나머지는 정기 유지보수 시기에 처리하는 식 으로 운영할 수 있다.

> 유지보수 창(Maintenance Window)은 클러스터의 정기적인 유지보수 작업을 수행하기 위해 미리 예약된 시간 범위를 의미한다.

#### 자동 페일오버
Amazon ElastiCache의 자동 페일오버 기능은 높은 내구성을 제공하며, 캐시 노드에 장애가 발생할 경우 내부 모니터링 메커니즘을 통해 자동으로 페일오버를 진행한다. 장애 발생 시 마스터 노드는 가장 최근의 레플리카로 자동 복구되며, 레플리케이션 지연 시간이 가장 짧은 레플리카가 마스터로 승격된다.

클러스터 모드가 비활성화된 Redis 클러스터에서는 자동 페일오버 기능 사용 여부를 선택할 수 있으나, 특별한 이유가 없다면 활성화하는 것이 권장된다. 클러스터 모드가 활성화된 Redis 클러스터에서는 과반수의 마스터를 사용할 수 없을 경우 자동으로 복구 작업이 진행된다.

ElastiCache에서는 Redis 센티넬을 사용하지 않지만, 대부분의 상황에서 기본 기능만으로 충분하다. 반면, OSS(오픈 소스) 버전의 Redis에서는 마스터 장애 시 자동 페일오버가 이루어지지 않아 수동으로 레플리카를 마스터로 승격해야 한다. 또한, OSS 버전의 Redis 클러스터 모드에서 과반수의 마스터를 사용할 수 없으면 클러스터 전체가 사용할 수 없게 된다.

#### 멀티 AZ
멀티 AZ 기능은 AWS AZ(논리적 데이터 센터 그룹)를 여러 개 사용하여 동시 장애를 피하는 시스템를 피하는 시스템으로 활성화되면 자동 페일오버 기능도 활성화된다.

성능 때문에 멀티 AZ의 사용을 꺼리는 사용자가 있을 수 있지만 대부분은 AZ 간 지연 시간은 문제가 되지 않고, 가용성 향상이라는 이점이 더 큰 경우 많다.

> 지연 시간을 엄격히 관리해야하고 가용성으로 인한 리스크를 받아들일 수 있는 경우 외에는 멀티 AZ 사용을 권장한다.

#### 온라인 리샤딩


#### 안전성과 보안 관리


#### I/O 처리 멀티 스레드화


#### 리전 간 레플리케이션 기능

