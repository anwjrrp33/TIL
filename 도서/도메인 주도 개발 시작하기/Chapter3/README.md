# 애그리거트

## 애그리거트
* 상위 수준 개념을 이용해서 전체 모델을 정리하면 전반적인 관계를 이해하는데 도움이 된다.
<br/><img src="./그림 3.1.png">
* 상위 모델에 대한 이해없이 상위 수준에서 개념을 파악할려면 오래 걸리며 많은코드를 보고 도메인 전문가와 더 많은 대화를 나눠야 비로소 상위 수준 모델 간의 관계가 이해되기 시작한다.
    * 도메인 객체 모델이 복잡하면 개별 구성요소 위주로 모델을 이해하게 되고 전반적인 구조나 큰 수준에서 도메인 간의 관계를 파악하기 어려워진다.
    * 코드를 변경하고 확장하는 것이 어려워진다는 것을 의미한다.
    * 당장 돌아가는 코드를 추가할 수는 있지만 이런 방법은 장기적으로 코드를 더 수정하기 어렵게 만든다.
<br/><img src="./그림 3.2.png">
* 복잡한 도메인을 이해하고 관리하기 쉬운 단위로 만들려면 상위 수준에서 모델을 조망할 수 있는 방법이 필요한데 그 방법이 `애그리거트`다.
    * 모델을 이해하는데 도움을 주며 일관성을 관리하는 기준이 된다.
    * 복잡한 도메인을 단순한 구조로 만들어주고 도메인 기능을 확장하고 변경하는데 필요한 노력(개발시간)도 줄어든다.
* 애그리거트의 경계를 설정할 때 기본이 되는 것은 도메인 규칙과 요구사항이다.
    * 도메인 규칙에 따라 함께 생성되는 구성요소는 한 애그리거트에 속할 가능성이 높다.
    * `A가 B를 갖는다` 라는 요구사항이 존재해도 한 애그리거트는 아니며 상품과 리뷰는 함께 생성되지도, 변경되지도 않기 때문에 한 애그리거트에 속하지 않는다.
* 처음 도메인 모델을 만들면 큰 애그리거트로 보이는 것들이 많지만 도메인에 대한 경험이 생기고 도메인 규칙을 제대로 이해할수록 애그리거트 실제 크기는 줄어든다.
    * 다수의 애그리거트가 한 개의 엔티티만 갖는 경우가 많고 두개 이상의 엔티티로 구성되는 애그리거트는 드물다.

## 애그리거트 루트
* 애그리거트는 여러객체를 구성되기 때문에 한 객체만 상태가 정상이면 안되며 도메인 규칙을 지키려면 애그리거트에 속한 모든 객체가 정상 상태를 가져야한다.
    * 주문이라는 애그리거트가 존재하면 OrderLine이 변경되면 Order의 totlaAmounts도 다시 계산해서 총 금액이 맞아야 한다.
* 애그리거트에 속한 모든 객체가 일관된 상태를 유지하려면 애그리거트 전체를 관리할 주체가 필요한데 이 책을 지는 것이 바로 애그리거트의 `루트 엔티티`다.
